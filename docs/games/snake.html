<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸè´ªåƒè›‡ğŸ</title>
  <style>
    body {
      text-align: center;
    }

    .root {
      border: 1px solid #ddd;
      display: flex;
      flex-wrap: wrap;
      margin: 0 auto;
    }

    .item {
      box-sizing: border-box;
      border: 1px solid #ddd;
    }

    .player {
      background-color: #444;
    }

    .food {
      background-color: tomato;
      animation: fade 800ms ease-in-out infinite;
    }
    /* åŠ¨ç”»é—ªçƒæ•ˆæœ */
    @keyframes fade {
      from {
        opacity: 1;
      }
      50% {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }
  </style>
</head>

<body>
  <div class="root"></div>
  <script>
    let size = 20,
      n = 20;
    let table = [];
    let player = [[1, 1]];
    let root = document.querySelector(".root");

    // ç”»æ¿åˆå§‹åŒ–
    const init = function () {
      //1. åˆ¶ä½œç”»æ¿
      for (let i = 0; i < n; i++) {
        for (let j = 0; j < n; j++) {
          // const isEat = Math.random() > 0.95 ? true : false;
          // if (i === 1 && j === 1 && isEat) {
          //   continue;//${isEat ? "food" : ""}
          // }
          table.push(
            `<div class = "item " data-v=_${i}-${j} 
          style="width:${size}px;height:${size}px"}></div>`
          );
        }
      }
      root.style.width = `${size * n}px`;
      root.style.height = `${size * n}px`;
      root.innerHTML = table.join("");//è¡¨æ ¼æ¸²æŸ“
    }

    // æ›´æ–°é£Ÿç‰©
    const newFood = function () {
      //ç”Ÿæˆ1-20çš„éšæœºæ•°ï¼Œæ„æˆåæ ‡(x,y)
      while (true) {
        const x = Math.floor(Math.random()*n);
        const y = Math.floor(Math.random()*n);
        // åˆ¤æ–­æ˜¯å¦åœ¨è›‡èº«ä¸Š
        if (JSON.stringify(player).indexOf('['+x+','+y+']') !== -1) {
          continue;
        }
        const food = x + '-' + y;
        // console.log(x,y);
        // è·å– Dom
        let foodDom = document.querySelector(`[data-v=_${food}]`);
        // console.log(foodDom);
        // ç»™é£Ÿç‰©ä¸Šè‰²
        foodDom.classList.add("food");
        break;
      }
    }

    // æ¸²æŸ“è›‡èº«
    const update = function () {
      //ç§»åŠ¨æ—¶æ¸…é™¤æ‰åŸæ¥è›‡èº«çš„æ ·å¼
      document.querySelectorAll(".player").forEach((item) => item.classList.remove("player"));
      // console.log(player);
      player.forEach((item) => {
        const local = item.join("-"); //åæ ‡æ‹¼æ¥
        document.querySelector(`[data-v=_${local}]`).classList.add("player"); //ç»™è›‡èº«é‡æ–°ä¸Šè‰²
      });
    };

    // æ–¹å‘æ§åˆ¶
    let key = ""; // è·å¾—é”®ä½
    let upDown = ['w', 's'];
    let leftRight = ['a', 'd'];
    document.addEventListener("keydown", (e) => {
      // åœ¨ä¸Šä¸‹è·‘çš„æ—¶å€™ï¼Œæ–¹å‘åªèƒ½æ”¹å˜ä¸ºå·¦å³ï¼Œä¸èƒ½æ‰å¤´
      if (upDown.includes(e.key) && !upDown.includes(key)) {
        key = e.key;
      }
      // åœ¨å·¦å³è·‘çš„æ—¶å€™ï¼Œæ–¹å‘åªèƒ½æ”¹å˜ä¸ºä¸Šä¸‹ï¼Œä¸èƒ½æ‰å¤´
      if (leftRight.includes(e.key) && !leftRight.includes(key)) {
        key = e.key;
      }
    });

    //è´ªåƒè›‡è‡ªåŠ¨è¿åŠ¨
    const time = setInterval(() => {
      if (key) {
        // è·å–å½“å‰è›‡èº«çš„å…¨ä½“åæ ‡ï¼ˆå»æ‰å°¾å·´ï¼‰ï¼Œåªæœ‰å¤´éƒ¨æ—¶ä¸ºç©ºæ•°ç»„ï¼Œ
        // sliceæ–¹æ³•ä¸æ”¹å˜åŸæ•°ç»„ï¼Œä½†æ˜¯æ•°ç»„é‡Œé¢è¿˜æ˜¯æ•°ç»„ï¼Œæ‰€ä»¥æ‹·è´çš„æ˜¯åœ°å€ï¼ŒåŸæ•°ç»„player[0][0]æ”¹å˜å®ƒä¹Ÿä¼šå˜
        const tmp1 = player.slice(0, player.length - 1);
        // console.log('tmp1',tmp1);
        // æ‹·è´ä¸€ä¸‹æ¶ˆé™¤å¯¹åŸæ•°ç»„çš„å½±å“
        const tmp = JSON.parse(JSON.stringify(tmp1));
        // console.log('tmp',tmp);

        // player[ [è¡Œåæ ‡,åˆ—åæ ‡ ] ] ,æ ¹æ®é”®ä½æ›´æ–°è›‡å¤´åæ ‡
        switch (key) {
          case "w":
            player[0][0] -= 1;
            break;
          case "s":
            player[0][0] += 1;
            break;
          case "a":
            player[0][1] -= 1;
            break;
          case "d":
            player[0][1] += 1;
            break;
        }

        const newHead = player[0].join("-"); //æ–°è›‡å¤´åæ ‡
        // è·å–æ–°è›‡å¤´çš„ DOM
        const judge = document.querySelector(`div[data-v=_${newHead}]`);
        // åˆ¤æ–­æ˜¯å¦æ’åˆ°å¢™å’Œè›‡èº«JSON.stringify(tmp).includes(JSON.stringify(player[0]))ä¹Ÿå¯
        if (!judge || judge.className.indexOf('player') !== -1) {
          //è¶Šç•Œç›´æ¥ç»“æŸ
          clearInterval(time);
          alert("Game Over!"); //ç»“æŸ
        } else {
          //æœªæ’å¢™åˆ™æ›´æ–°(é™¤å»è›‡å¤´çš„ï¼Œè›‡å¤´å·²ç»æ›´æ–°åœ¨player[0]ä¸­)è›‡èº«çš„åæ ‡
          for (let i = 1; i < player.length; i++) {
            player[i] = tmp[i - 1];
          }
          //å¦‚æœè¿™ä¸€æ ¼æ˜¯ä¸ªé£Ÿç‰©,é‚£ä¹ˆå°±åŠ å…¥åˆ°playeré‡Œé¢
          if (judge.className.indexOf("food") >= 0) {
            judge.classList.remove("food");
            newFood();
            player.unshift([...player[0]]);//è›‡èº«å¢é•¿
          }
          update(); //æ¸²æŸ“èŠ‚ç‚¹
        }
      }
    }, 300);

    // æ¸¸æˆåˆå§‹åŒ–
    init(); // é‡æ–°å¼€å§‹
    newFood(); // ç”Ÿæˆä¸€ä¸ªåƒçš„
    update(); // æ‰§è¡Œå‡½æ•°,é¦–æ¬¡æ¸²æŸ“çš„å¤´ç»“ç‚¹åœ¨æ­¤
  </script>
</body>

</html>